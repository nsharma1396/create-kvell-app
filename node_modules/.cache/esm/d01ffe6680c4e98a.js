let chalk,path,resolve,mkdir,writeFile,readFile,url,copy,remove,ensureFile,promisify,runChildProcess,generateNpmRcTemplate;_80c‍.x([["createProject",()=>createProject]]);_80c‍.w("chalk",[["default",["chalk"],function(v){chalk=v}]]);_80c‍.w("path",[["default",["path"],function(v){path=v}],["resolve",["resolve"],function(v){resolve=v}]]);_80c‍.w("fs",[["mkdir",["mkdir"],function(v){mkdir=v}],["writeFile",["writeFile"],function(v){writeFile=v}],["readFile",["readFile"],function(v){readFile=v}]]);_80c‍.w("url",[["default",["url"],function(v){url=v}]]);_80c‍.w("fs-extra",[["copy",["copy"],function(v){copy=v}],["remove",["remove"],function(v){remove=v}],["ensureFile",["ensureFile"],function(v){ensureFile=v}]]);_80c‍.w("util",[["promisify",["promisify"],function(v){promisify=v}]]);_80c‍.w("./runChildProcess",[["runChildProcess",["runChildProcess"],function(v){runChildProcess=v}]]);_80c‍.w("./generateNpmRcTemplate",[["default",["generateNpmRcTemplate"],function(v){generateNpmRcTemplate=v}]]);









const makeDir = promisify(mkdir);
const readFileFromPath = promisify(readFile);
const writeFileToPath = promisify(writeFile);

const log = _80c‍.g.console.log;

const makeDirectory = async projectDirectoryPath => {
  try {
    await makeDir(projectDirectoryPath);
    return "success";
  } catch (exception) {
    log();
    log("Could not create directory.");
    log();
    log("Error detail:");
    log(chalk.redBright(exception.message));
    log();
    // process.exit(0);
    // return { status: "error" };
    throw exception;
  }
};

const copyTemplate = async (
  // databaseName,
  templateFolderPath,
  projectDirectoryPath,
  directoryName
) => {
  try {
    await copy(templateFolderPath, projectDirectoryPath);
    log(chalk.greenBright(`Added Node.js basic template to ${directoryName}`));
  } catch (exception) {
    log();
    log("Could not add boilerplate template.");
    log();
    log(chalk.redBright(exception.message));
    log();
  }
};

const ensureNpmrc = async (projectDirectoryPath, _directoryName) => {
  const npmRcPath = path.resolve(projectDirectoryPath, ".npmrc");
  _80c‍.g.console.log(npmRcPath);
  await ensureFile(npmRcPath);
  await writeFileToPath(npmRcPath, generateNpmRcTemplate());
};

const updatePackageJSON = async (projectDirectoryPath, directoryName) => {
  try {
    const pathToPackageJSON = `${projectDirectoryPath}/package.json`;
    const packageJSON = await readFileFromPath(pathToPackageJSON, "utf-8");
    log();
    const parsedPackageJSON = JSON.parse(packageJSON);
    parsedPackageJSON.name = directoryName;
    const stringifiedJSON = JSON.stringify(parsedPackageJSON, null, 2);
    await writeFileToPath(pathToPackageJSON, stringifiedJSON);
    return "success";
  } catch (exception) {
    log("There was an issue while creating the template.");
    log(chalk.redBright(`Error: ${exception.message}`));
    // process.exit(0);
    throw exception;
  }
};

const initializeGit = async directoryPath => {
  const command = "git";
  const args = ["init"];
  const options = { cwd: directoryPath, stdio: "inherit" };

  try {
    log();
    // log("Initializing empty git repository...");
    log();
    await runChildProcess(command, args, options);
    log();
    // log(`${chalk.green("Initialized git repository.")}`);
    log();
    return true;
  } catch (exception) {
    log();
    log(`${chalk.red("Failed")} to initialize git repository.`);
    log("Skipping git initialization...");
    log();
    return false;
  }
};

const installDependencies = async directoryPath => {
  // Change current working directory to the project directory
  log("Installing dependencies...");
  log();
  // process.chdir(directoryPath);
  const command = "npm";
  const args = ["install", "--save", "--save-exact", "--loglevel", "error"];
  const options = { cwd: directoryPath, stdio: "inherit" };
  await runChildProcess(command, args, options);
};

       const createProject = async directoryName => {
  const currentPathURL = _80c‍._.meta.url;
  // Commenting URL since it is only available after Node v10.0.0
  // const currentPathName = new URL(currentPathURL).pathname;
  const currentPathName = new url.URL(currentPathURL).pathname;
  const resolvedPath = resolve(currentPathName, `..`, `..`, `..`, `templates`, `basic`); // databaseName);

  const templateFolderPath = resolvedPath;

  const projectDirectoryParentPath = process.cwd();
  const projectDirectoryPath = path.resolve(projectDirectoryParentPath, directoryName);

  log();
  log(
    `Creating new Node boilerplate in ${chalk.bold.green(projectDirectoryPath)}` // with database as ${chalk.bold.green(databaseName)}.`
  );
  log();

  try {
    await makeDirectory(projectDirectoryPath);

    log(`Created directory ${chalk.greenBright(directoryName)}`);
    log();
    // log("Adding boilerplate template...");

    await copyTemplate(templateFolderPath, projectDirectoryPath, directoryName);

    await ensureNpmrc(projectDirectoryPath, directoryName);
    // await updatePackageJSON(projectDirectoryPath, directoryName);

    // // const isGitInitialized =
    // await initializeGit(projectDirectoryPath);

    // await installDependencies(projectDirectoryPath);
  } catch (e) {
    // log(e.message);
    log();
    _80c‍.g.console.error(e.message);
    log();
    log(`Removing directory ${directoryName}...`);
    log();
    await remove(projectDirectoryPath);
    log("Directory removed.");
    // process.exit(0);
  }
};
